<app-header></app-header>

<div class="container-fluid">

    <!-- Orders List -->
    <div class="orders">
        <div class="heading">
            <h4>Order List</h4>
        </div>

        <div class="order-cards">
            <div class="order-card" *ngFor="let order of orderList">
                <img [src]="order.img" alt="{{ order.name }}">
                <div class="order-details">
                    <h5>{{ order.name }}</h5>

                    <!-- Rating as stars -->
                    <div class="rating">
                        <ng-container *ngFor="let star of [0,1,2,3,4]; let i = index">
                            <i class="bi" [ngClass]="getStars(order.rating, i)"></i>
                        </ng-container>
                    </div>

                    <!-- Price -->
                    <div class="price-row">
                        <div class="price-col">
                            <span class="price">₹{{ order.discountedPrice }}</span>
                            <span class="original-price" *ngIf="order.actualPrice > order.discountedPrice">
                                ₹{{ order.actualPrice }}
                            </span>
                            <span class="discount" *ngIf="order.actualPrice > order.discountedPrice">
                                {{ getDiscount(order.actualPrice, order.discountedPrice) }}% OFF
                            </span>
                        </div>
                    </div>

                    <!-- Quantity -->
                    <div class="quantity">
                        <label>Qty:</label>
                        <input type="number" [(ngModel)]="order.quantity" min="1">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Address Selection -->
    <div class="address-section" *ngIf="addresses.length">
        <h4>Delivery Address</h4>
        <div class="address-row" *ngFor="let addr of addresses">
            <div class="form-check address-card">
                <input class="form-check-input" type="radio" name="selectedAddress" [value]="addr"
                    [(ngModel)]="selectedAddress" [checked]="addr.isDefault">
                <label class="form-check-label">
                    <strong>{{ addr.name }}</strong> - {{ addr.address }}, {{ addr.city }}, {{ addr.state }} - {{
                    addr.postalCode }} <br>
                    {{ addr.country }} <br>
                    <strong>Phone:</strong> {{ addr.phone }} <span *ngIf="addr.landmark"> | Landmark: {{ addr.landmark
                        }}</span>
                    <span *ngIf="addr.isDefault" class="badge bg-success ms-2">Default</span>
                </label>
            </div>
        </div>
    </div>

    <!-- Coupon Section -->
    <div class="coupon-section mt-4">
        <h4>Apply Coupon</h4>
        <div class="d-flex gap-2">
            <input type="text" class="form-control" placeholder="Enter coupon code" [(ngModel)]="couponCode">
            <button (click)="applyCoupon()" [disabled]="!couponCode" class="btn btn-primary">Apply</button>
        </div>
        <div *ngIf="couponError" class="text-danger mt-1">{{ couponError }}</div>
        <div *ngIf="couponDiscount > 0" class="text-success mt-1">
            Coupon applied! You saved ₹{{ couponDiscount | number:'1.2-2' }}
        </div>
    </div>

    <!-- Price Summary -->
    <div class="price-summary mt-4">
        <h4>Price Summary</h4>
        <div class="summary-row" *ngIf="orderList.length">
            <div>Total Items:</div>
            <div>{{ getTotalItems() }}</div>
        </div>
        <div class="summary-row">
            <div>Total Price:</div>
            <div>₹{{ getTotalPrice() | number:'1.2-2' }}</div>
        </div>
        <div class="summary-row">
            <div>Total Discount:</div>
            <div>₹{{ getTotalDiscount() | number:'1.2-2' }}</div>
        </div>
        <div class="summary-row fw-bold">
            <div>Final Amount:</div>
            <div>₹{{ getFinalAmount() | number:'1.2-2' }}</div>
        </div>
    </div>

    <!-- Checkout Button -->
    <div class="checkout-btn mt-4 text-center">
        <button [disabled]="!selectedAddress">Check Out</button>
    </div>

</div>

<app-footer></app-footer>